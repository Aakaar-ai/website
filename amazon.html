<!DOCTYPE html>
<html lang="en">
<head>
  <script src="https://api-cdn.amazon.com/sdk/login1.js"></script>
  <script>
    async function fetchClientId() {
      try {
        const response = await fetch('/.netlify/functions/getClientId');
        if (!response.ok) throw new Error('Failed to fetch client ID');
        const { clientId } = await response.json();
        return clientId;
      } catch (error) {
        console.error(error);
        return null;
      }
    }

    window.onAmazonLoginReady = async function () {
      try {
      const clientId = await fetchClientId();
      if (!clientId) {
        console.error('Client ID is not set.');
        return;
      }
      console.log('Setting Client ID:', clientId);
      amazon.Login.setClientId(clientId);
      amazon.Login.setUseCookie(true);
      amazon.Login.setDebug(true);
    }catch(e) {
      console.error('Amazon Login SDK Error:', e);
    }
    };

    async function loginWithAmazon() {
      try {
        amazon.Login.authorize(
          {
            scope: 'profile',
            redirect_uri: 'https://your-netlify-site.netlify.app/.netlify/functions/server',
          },
          function (response) {
            if (response.error) {
              console.error('Login failed:', response.error);
              return;
            }
            console.log('Authorization successful! Access Token:', response.access_token);
          }
        );
      } catch (err) {
        console.error('Error during Amazon Login:', err);
      }
    }
  </script>
</head>
<body>
  <button onclick="loginWithAmazon()">Login with Amazon</button>
</body>
</html>